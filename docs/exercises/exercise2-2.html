<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Viz with R - Step-by-step guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../exercises/exercise3-1.html" rel="next">
<link href="../exercises/exercise2-1.html" rel="prev">
<link href="../images/hot-air-balloon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/hot-air-balloon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Viz with R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> <i class="bi bi-house-fill" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lectures/overview.html"> <i class="bi bi-easel3-fill" role="img">
</i> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../exercises/overview.html"> <i class="bi bi-code-slash" role="img">
</i> 
<span class="menu-text">Exercises</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../exercises/overview.html">Exercises</a></li><li class="breadcrumb-item">Day 1. Data cleaning</li><li class="breadcrumb-item"><a href="../exercises/exercise2-1.html">Exercise 2 (Advanced)</a></li><li class="breadcrumb-item"><a href="../exercises/exercise2-2.html">Step-by-step guide</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Housekeeping</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home/prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prerequisites</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home/poll.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../home/orientation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Orientation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lectures/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lectures</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1. GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Day 1. Data cleaning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Exercise 1 (Beginner)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise1-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise1-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Exercise 2 (Advanced)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise2-2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Step-by-step guide</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Day 2. Visualisation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Exercise 3 (Beginner)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Step-by-step guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth4 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1. The base plot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 2. Adding text labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 3. Adding highlight colours in the title</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 4. Adding a bespoke legend</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
 <span class="menu-text">Exercise 4 (Advanced)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise4-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise4-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step guide</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#set-up-your-code-file-meta-data" id="toc-set-up-your-code-file-meta-data" class="nav-link active" data-scroll-target="#set-up-your-code-file-meta-data"><span class="header-section-number">1</span> Set up your code file meta data</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries"><span class="header-section-number">2</span> Load libraries</a></li>
  <li><a href="#commit-your-changes" id="toc-commit-your-changes" class="nav-link" data-scroll-target="#commit-your-changes"><span class="header-section-number">3</span> Commit your changes</a></li>
  <li><a href="#download-the-data-locally" id="toc-download-the-data-locally" class="nav-link" data-scroll-target="#download-the-data-locally"><span class="header-section-number">4</span> Download the data locally</a></li>
  <li><a href="#read-in-the-data-to-r" id="toc-read-in-the-data-to-r" class="nav-link" data-scroll-target="#read-in-the-data-to-r"><span class="header-section-number">5</span> Read in the data to R</a></li>
  <li><a href="#subset-to-the-12-rows-with-data-on-chronic-conditions" id="toc-subset-to-the-12-rows-with-data-on-chronic-conditions" class="nav-link" data-scroll-target="#subset-to-the-12-rows-with-data-on-chronic-conditions"><span class="header-section-number">6</span> Subset to the 12 rows with data on chronic conditions</a></li>
  <li><a href="#select-the-columns-of-interest" id="toc-select-the-columns-of-interest" class="nav-link" data-scroll-target="#select-the-columns-of-interest"><span class="header-section-number">7</span> Select the columns of interest</a></li>
  <li><a href="#pivot-from-wide-format-to-long-format" id="toc-pivot-from-wide-format-to-long-format" class="nav-link" data-scroll-target="#pivot-from-wide-format-to-long-format"><span class="header-section-number">8</span> Pivot from wide format to long format</a></li>
  <li><a href="#rename-the-variable-x" id="toc-rename-the-variable-x" class="nav-link" data-scroll-target="#rename-the-variable-x"><span class="header-section-number">9</span> Rename the variable <code>X</code></a></li>
  <li><a href="#tidy-up-the-period-variable" id="toc-tidy-up-the-period-variable" class="nav-link" data-scroll-target="#tidy-up-the-period-variable"><span class="header-section-number">10</span> Tidy up the <code>period</code> variable</a></li>
  <li><a href="#tidy-up-the-condition-variable" id="toc-tidy-up-the-condition-variable" class="nav-link" data-scroll-target="#tidy-up-the-condition-variable"><span class="header-section-number">11</span> Tidy up the <code>condition</code> variable</a></li>
  <li><a href="#drop-the-old-variable-period" id="toc-drop-the-old-variable-period" class="nav-link" data-scroll-target="#drop-the-old-variable-period"><span class="header-section-number">12</span> Drop the old variable <code>period</code></a></li>
  <li><a href="#save-the-clean-dataset" id="toc-save-the-clean-dataset" class="nav-link" data-scroll-target="#save-the-clean-dataset"><span class="header-section-number">13</span> Save the clean dataset</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../exercises/overview.html">Exercises</a></li><li class="breadcrumb-item">Day 1. Data cleaning</li><li class="breadcrumb-item"><a href="../exercises/exercise2-1.html">Exercise 2 (Advanced)</a></li><li class="breadcrumb-item"><a href="../exercises/exercise2-2.html">Step-by-step guide</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Step-by-step guide</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="set-up-your-code-file-meta-data" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Set up your code file meta data</h1>
<p>As before, you should your code file with some meta information in the form of commented out text.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-meta" class="quarto-xref">☠ Hint&nbsp;1</a></p>
</div></div><div style="display: none;">
<div id="hint-meta" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-meta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Include similar information to last time: the project name and purpose, and the code inputs and outputs.</p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-meta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;1
</figcaption>
</figure>
</div>
</div>
<hr>
</section>
<section id="load-libraries" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Load libraries</h1>
<p>Load all of your libraries in a single location at the top of the file.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-libraries" class="quarto-xref">☠ Hint&nbsp;2</a></p>
</div></div><div style="display: none;">
<div id="hint-libraries" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-libraries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Start with the three libraries from the last exercise: <code>readxl</code>, <code>dplyr</code>, and <code>tidyr</code>.</p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-libraries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;2
</figcaption>
</figure>
</div>
</div>
<hr>
</section>
<section id="commit-your-changes" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Commit your changes</h1>
<p>Remember it is good practice to commit your changes regularly. You can do that now.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-git" class="quarto-xref">☠ Hint&nbsp;3</a></p>
</div></div><div style="display: none;">
<div id="hint-git" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-git-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>This isn’t essential but it’s good to get into the practice. You don’t have to push every time you commit.</p>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-git-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;3
</figcaption>
</figure>
</div>
</div>
<hr>
</section>
<section id="download-the-data-locally" class="level1 page-columns page-full" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Download the data locally</h1>
<p>Download the raw data using the ABS website link below and the <code>download.file()</code> function.</p>
<p><a href="https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey/2022/NHSDC01.xlsx" class="uri">https://www.abs.gov.au/statistics/health/health-conditions-and-risks/national-health-survey/2022/NHSDC01.xlsx</a></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-download" class="quarto-xref">☠ Hint&nbsp;4</a></p>
</div></div><div style="display: none;">
<div id="hint-download" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-download-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Use the same code as before. Remember to update the URL and destination file name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spreadsheet url</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>myURL <span class="ot">&lt;-</span> <span class="st">" "</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the file locally</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> , </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-download-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;4
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should see the <code>.xlsx</code> spreadsheet downloaded into your <strong>exercises/2-raw-data</strong> folder.</p>
</div>
</div>
<hr>
</section>
<section id="read-in-the-data-to-r" class="level1 page-columns page-full" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Read in the data to R</h1>
<p>Read in the raw data from the sheet <strong>Table 1.3_Proportions</strong> using the <code>read_excel()</code> function. Remember the same key arguments from last time:</p>
<ul>
<li><strong>path</strong> Where you have downloaded the excel file</li>
<li><strong>sheet</strong> The sheet you want to read from</li>
<li><strong>skip</strong> The number of lines to skip before reading</li>
<li><strong>.name_repair</strong> the function to make names unique</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-read" class="quarto-xref">☠ Hint&nbsp;5</a></p>
</div></div><div style="display: none;">
<div id="hint-read" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-read-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Use the same code as before. Check in the excel file how many rows you want to skip so that the years (2001 2004–05 etc) are the first row of data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the raw data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df2Raw <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">" "</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">" "</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> ,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.name_repair =</span>  </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-read-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;5
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should be able to see the data frame in your R Environment pane. Check that it has 130 rows and 15 variables.</p>
</div>
</div>
<hr>
</section>
<section id="subset-to-the-12-rows-with-data-on-chronic-conditions" class="level1 page-columns page-full" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Subset to the 12 rows with data on chronic conditions</h1>
<p>Start your data cleaning by filtering to the rows that contain the chronic conditions (arthritis, asthma etc). These should be in rows 12 to 23 (but check in your data).</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-slice" class="quarto-xref">☠ Hint&nbsp;6</a></p>
</div></div><div style="display: none;">
<div id="hint-slice" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-slice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Use the <code>slice()</code> function to subset to the rows you need, for example, this would subset to rows 4 to 6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean the raw data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df2Clean <span class="ot">&lt;-</span> df2Raw <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-slice-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;6
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your dataframe should have 12 rows, one for each chronic condition.</p>
</div>
</div>
<hr>
</section>
<section id="select-the-columns-of-interest" class="level1 page-columns page-full" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Select the columns of interest</h1>
<p>Select the first column (with the chronic conditions) and the columns with age-standardised proportions. If you specified <code>.name_repair = ~ make.names(.x, unique = TRUE)</code> then the columns with age-standardised proportions will all end with <code>.1</code>.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-select" class="quarto-xref">☠ Hint&nbsp;7</a></p>
</div></div><div style="display: none;">
<div id="hint-select" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-select-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>As before, use <code>select()</code> to select the variables you want to keep. <code>ends_with()</code> is a useful function to select multiple variables with the same name.</p>
<p>For example, this would select the variables <code>species</code>, <code>bill_length_mm</code> and <code>flipper_length_mm</code> from the <code>penguins</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(<span class="fu">c</span>(species, <span class="fu">ends_with</span>(<span class="st">"length_mm"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-select-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;7
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your dataframe should have 8 variables: the column of chronic conditions and the 7 date columns.</p>
</div>
</div>
<hr>
</section>
<section id="pivot-from-wide-format-to-long-format" class="level1 page-columns page-full" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Pivot from wide format to long format</h1>
<p>Currently we are in wide format, with one column for each survey period, and the proportions in the cells. We need to move to long format with a single column for the survey period and a single column for the percentages.</p>
<p>We can achieve this using <code>pivot_longer()</code>. Remember, there are a few important arguments:</p>
<ul>
<li><strong>cols</strong> The variables we want to stack when we move from wide to long, i.e.&nbsp;the variables that are the survey periods ending in <code>.1</code>.</li>
<li><strong>names_to</strong> The name of the new variable containing the survey periods.</li>
<li><strong>values_to</strong> The name of the new variable containing the percentages</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-pivot" class="quarto-xref">☠ Hint&nbsp;8</a></p>
</div></div><div style="display: none;">
<div id="hint-pivot" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-pivot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>This step is tricky. If you copied the approach from last time you may well have encountered the error <strong>! Can’t combine <code>X2001.1</code> <character> and <code>X2022.1</code> <double></double></character></strong></p>
<p>This arises because some of the columns were read in as numeric while others were read in as character (the character columns had the text “na” somewhere in the original spreadsheet). Trying to stack character variables on top of numeric variables causes problems.</p>
<p>To get around this, we need to add the <code>values_transform = as.numeric</code> argument in <code>pivot_longer()</code>. This argument makes sure all of the variables are numeric when they are stacked.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot longer</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">".1"</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">'period'</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">'percent'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_transform =</span> as.numeric) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-pivot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;8
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>All going well you should have 84 rows (12 conditions <span class="math inline">\(\times\)</span> 7 survey periods) and three columns: <code>X</code>, <code>period</code> and <code>percent.</code></p>
<p>Don’t worry if you get a warning message about NAs. Some of the time series are missing data, for example there is no data point for diabetes in 2004-05.</p>
</div>
</div>
<hr>
</section>
<section id="rename-the-variable-x" class="level1 page-columns page-full" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Rename the variable <code>X</code></h1>
<p>We still have the unsightly variable name <code>X</code>. Go ahead and rename it to <code>condition.</code></p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-rename" class="quarto-xref">☠ Hint&nbsp;9</a></p>
</div></div><div style="display: none;">
<div id="hint-rename" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-rename-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Remember the syntax</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">newName =</span> oldName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-rename-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;9
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’re doing great!</p>
</div>
</div>
<hr>
</section>
<section id="tidy-up-the-period-variable" class="level1 page-columns page-full" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Tidy up the <code>period</code> variable</h1>
<p>This is a tricky step so the full solution is outlined below. Among other things we encounter dates for the first time.</p>
<p>The <code>period</code> variable refers to the survey period, but it is a bit of a disaster with entries like <strong>X2001.1</strong> and <strong>X2004.05.1</strong>. We need to tidy it up to have nicely formatted dates instead of these weird strings.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-period" class="quarto-xref">☠ Hint&nbsp;10</a></p>
</div></div><div style="display: none;">
<div id="hint-period" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-period-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/molly-ball.jpeg" class="img-fluid figure-img"></p>
<figcaption>That was pretty full on so there is no hint beyond the code in the instructions. You got this like Molly got her ball.</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-period-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;10
</figcaption>
</figure>
</div>
</div>
<p>Referring back to the original spreadsheet, these dates refer to single calendar years (for 2001 and 2022) and multiple calendar years like 2004-05 and 2007-08.</p>
<p>While the survey collection period naturally spanned months or years, for the purpose of plotting we want to be able to choose a single date. For whole years, we will choose the mid-year point i.e.&nbsp;July 1. For survey periods that spanned multiple years we will choose the first day of the second year, i.e.&nbsp;January 1. To summarise, we want to assign the survey periods to specific dates as follows.</p>
<ul>
<li>2001 <span class="math inline">\(\rightarrow\)</span> 01/07/2001</li>
<li>2004-05 <span class="math inline">\(\rightarrow\)</span> 01/01/2005</li>
<li>2007-08 <span class="math inline">\(\rightarrow\)</span> 01/01/2008</li>
<li>2011-12 <span class="math inline">\(\rightarrow\)</span> 01/01/2012</li>
<li>2014-15 <span class="math inline">\(\rightarrow\)</span> 01/01/2015</li>
<li>2017-18 <span class="math inline">\(\rightarrow\)</span> 01/01/2018</li>
<li>2022 <span class="math inline">\(\rightarrow\)</span> 01/07/2022</li>
</ul>
<p>We could hard code this, but noticing there are only two date formats we can also use an <code>ifelse()</code> function, with one rule for single year dates like <strong>X2001.1</strong> and a second rule for multiple year dates like <strong>X2004.05.1</strong></p>
<p>Here’s what the code looks like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="fu">nchar</span>(period)<span class="sc">==</span><span class="dv">7</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">paste</span>(<span class="fu">as.numeric</span>(<span class="fu">substr</span>(period, <span class="dv">2</span>, <span class="dv">5</span>)), <span class="st">'07'</span>, <span class="st">'01'</span>, <span class="at">sep=</span><span class="st">'-'</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">paste</span>(<span class="fu">as.numeric</span>(<span class="fu">substr</span>(period, <span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">+</span> <span class="dv">1</span>, <span class="st">'01'</span>, <span class="st">'01'</span>, <span class="at">sep=</span><span class="st">'-'</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s a few things going on so let’s break it down.</p>
<ul>
<li><p>We start with <code>mutate(date = as.Date(...))</code> to create a new variable named <code>date</code> that has a date format. The <code>as.Date()</code> function converts strings that look like dates to actual Date objects in R. Try entering <code>as.Date("2024-11-21")</code> in the console for example.</p></li>
<li><p>Inside the <code>as.Date()</code> function we are calling <code>ifelse()</code>. The logical condition that is tested is whether the period string has 7 characters. So this will be <code>TRUE</code> for the string <strong>X2001.1</strong> but false for the string <strong>X2004.05.1</strong>. You can test this yourself by entering <code>nchar("X2001.1")</code> at the console.</p></li>
<li><p>For dates like <strong>X2001.1</strong> the rule is <code>paste(as.numeric(substr(period, 2, 5)), '07', '01', sep='-')</code>. This extracts the year and combines it with the strings “07” and “01”, separated by “-”. The result is something like “2001-07-01”. To see this in action, try entering <code>paste(as.numeric(substr("X2001.1", 2, 5)), '07', '01', sep='-')</code> at the console.</p></li>
<li><p>For dates like <strong>X2004.05.1</strong> the rule is <code>paste(as.numeric(substr(period, 2, 5)) + 1, '01', '01', sep='-')</code>. This extracts the first year, adds 1 then combines it with the strings “01” and “01”, separated by “-”. The result is something like “2005-01-01”. To see this in action, try entering <code>paste(as.numeric(substr("X2007.08.1", 2, 5)) + 1, '01', '01', sep='-')</code> at the console.</p></li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>If run successfully, you should now have a new variable named date, which is also formatted as a date object. You can test this by entering is the <code>is.Date()</code> function from the <code>lubridate</code> package. Try entering the following at the console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">is.Date</span>(df2Clean<span class="sc">$</span>date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="tidy-up-the-condition-variable" class="level1 page-columns page-full" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Tidy up the <code>condition</code> variable</h1>
<p>The categories of the chronic conditions still include footnotes, like <strong>Arthritis(d)</strong>, or long names like <strong>Cancer (malignant neoplasms)</strong>. When we come to plot these we are going to want the labels to be relatively short so we will tidy these up now.</p>
<p>Use <code>mutate()</code> and <code>case when()</code> to create shorter and tidier category names for the condition variable.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-condition" class="quarto-xref">☠ Hint&nbsp;11</a></p>
</div></div><div style="display: none;">
<div id="hint-condition" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-condition-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Arthritis(d)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Asthma"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Back problems (dorsopathies)(e)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Cancer (malignant neoplasms)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Chronic obstructive pulmonary disease (COPD)(f)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Diabetes mellitus(g)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Hayfever and allergic rhinitis"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Heart, stroke and vascular disease(h)"</span>  <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Hypertension(i)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Kidney disease(j)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Mental and behavioural conditions(k)(l)(m)"</span> <span class="sc">~</span> <span class="st">" "</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      condition<span class="sc">==</span><span class="st">"Osteoporosis(n)"</span> <span class="sc">~</span> <span class="st">" "</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-condition-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;11
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you view your dataframe, the categories in the updated condition name should look short and neat. You can check the length of the longest variable by pasting the code below at the console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">nchar</span>(df2Clean<span class="sc">$</span>condition))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="drop-the-old-variable-period" class="level1 page-columns page-full" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Drop the old variable <code>period</code></h1>
<p>Now that we have a nicely formatted <code>date</code> variable we won’t need the old variable <code>period</code> so go ahead and drop that.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-drop" class="quarto-xref">☠ Hint&nbsp;12</a></p>
</div></div><div style="display: none;">
<div id="hint-drop" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-drop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Remember to drop a variable you can use <code>select()</code> with <code>-</code> in front of the variable name. For example this would drop the variable <code>speed</code> from the cars dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>speed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-drop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;12
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your tidy dataset should have 84 rows and three variables: <code>condition</code>, <code>date</code>, and <code>percent</code>.</p>
</div>
</div>
<hr>
</section>
<section id="save-the-clean-dataset" class="level1 page-columns page-full" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Save the clean dataset</h1>
<p>Amazing, you made it! The final step is to save the clean dataset locally. We can follow the code from Exercise 1 to save it in both <code>.Rda</code> and <code>.csv</code> format, using <code>save()</code> and <code>write.csv()</code> respectively.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p><a href="#hint-save" class="quarto-xref">☠ Hint&nbsp;13</a></p>
</div></div><div style="display: none;">
<div id="hint-save" class="quarto-float">
<figure class="quarto-float quarto-float-hint figure">
<div aria-describedby="hint-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<p>Follow the code from last time, but remember to update the file names!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data in .Rda format</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(XXX, <span class="at">file =</span> )</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data in .csv format</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(XXX,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> ,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-hint quarto-uncaptioned" id="hint-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
☠ Hint&nbsp;13
</figcaption>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your tidy dataset should have 84 rows and three variables: <code>condition</code>, <code>date</code>, and <code>percent</code>.</p>
</div>
</div>
<hr>
<div style="margin: 0 auto;">
<p>Congratulations, you made it!!</p>
<iframe src="https://giphy.com/embed/l0unkiodQqmA3lPO5e" width="480" height="269" style="" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
<p>
<a href="https://giphy.com/gifs/Dogtopia-good-job-success-you-rock-l0unkiodQqmA3lPO5e">via GIPHY</a>
</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cbdrh\.github\.io\/data-viz-workshop\/home\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../exercises/exercise2-1.html" class="pagination-link" aria-label="Getting started">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Getting started</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../exercises/exercise3-1.html" class="pagination-link" aria-label="Getting started">
        <span class="nav-page-text">Getting started</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © UNSW 2024
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>